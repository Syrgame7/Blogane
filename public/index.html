<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Blogane Ultra</title>
    <script src="/socket.io/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg: #0f172a; --panel: rgba(30, 41, 59, 0.9); --primary: #8b5cf6; --accent: #ec4899; --gold: #fbbf24; --text: #fff; --glass: blur(15px); }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); background-image: radial-gradient(circle at top, #312e81 0%, transparent 60%); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* --- Top Ticker (Gift Bar) --- */
        .gift-ticker {
            position: fixed; top: 0; left: 0; width: 100%; height: 40px;
            background: linear-gradient(90deg, #f59e0b, #d97706);
            z-index: 2000; display: flex; align-items: center; overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5); pointer-events: none;
            transform: translateY(-100%); transition: 0.3s;
        }
        .gift-ticker.show { transform: translateY(0); }
        .ticker-content { display: flex; align-items: center; gap: 10px; padding: 0 15px; white-space: nowrap; animation: slideTicker 10s linear infinite; color: white; font-weight: bold; }
        @keyframes slideTicker { from { transform: translateX(100%); } to { transform: translateX(-100%); } }

        /* UI */
        .btn { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; border: none; padding: 8px 16px; border-radius: 12px; font-weight: bold; cursor: pointer; }
        .card { background: var(--panel); backdrop-filter: var(--glass); border: 1px solid rgba(255,255,255,0.1); border-radius: 18px; padding: 15px; margin-bottom: 15px; }
        .input-box { width: 100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); padding: 12px; border-radius: 12px; color: white; outline: none; }
        .avatar { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary); }

        /* Reels */
        .reel-item { height: calc(100vh - 75px); background: black; position: relative; scroll-snap-align: start; display: flex; justify-content: center; }
        .reel-overlay { position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent); pointer-events: none; }
        .reel-actions { position: absolute; right: 10px; bottom: 100px; display: flex; flex-direction: column; gap: 20px; pointer-events: auto; }
        .r-btn { display: flex; flex-direction: column; align-items: center; color: white; text-shadow: 1px 1px 2px black; cursor: pointer; }
        .r-btn i { font-size: 28px; margin-bottom: 5px; }
        .reel-comments-sheet { position: absolute; bottom: 0; left: 0; width: 100%; height: 60%; background: #1e293b; border-radius: 20px 20px 0 0; z-index: 10; display: none; flex-direction: column; animation: slideUp 0.3s; }

        /* 40 Gifts Grid */
        .gift-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 15px; max-height: 300px; overflow-y: auto; }
        .gift-item { background: rgba(255,255,255,0.05); padding: 8px; border-radius: 10px; text-align: center; cursor: pointer; border: 1px solid transparent; font-size: 12px; }
        .gift-item:hover { border-color: var(--gold); background: rgba(251, 191, 36, 0.1); }
        .gift-emoji { font-size: 24px; display: block; }

        /* Layout */
        .bottom-nav { height: 75px; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px); display: flex; justify-content: space-around; align-items: center; position: fixed; bottom: 0; width: 100%; z-index: 500; border-top: 1px solid rgba(255,255,255,0.1); }
        .nav-item { color: var(--gray); font-size: 22px; cursor: pointer; position: relative; }
        .nav-item.active { color: var(--primary); transform: translateY(-5px); }
        .header { padding: 15px; background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .view { display: none; height: 100%; overflow-y: auto; padding-bottom: 100px; }
        .view.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from{opacity:0}to{opacity:1} }
        @keyframes slideUp { from{transform:translateY(100%)}to{transform:translateY(0)} }

        /* Loaders */
        .loader-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.95); z-index: 2000; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .spinner { width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); z-index: 1000; display: none; justify-content: center; align-items: center; }
        .modal-box { background: #1e293b; width: 90%; max-width: 400px; padding: 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); }
    </style>
</head>
<body>

    <!-- Audio -->
    <audio id="snd-start" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>
    <audio id="snd-msg" src="https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3"></audio>
    <audio id="snd-gift" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"></audio>
    <audio id="snd-ticker" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>

    <!-- Ticker -->
    <div id="gift-ticker" class="gift-ticker"><div class="ticker-content" id="ticker-text"></div></div>

    <div class="loader-overlay" id="loader"><div class="spinner"></div><p style="margin-top:15px; color:white">ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</p></div>

    <!-- Auth -->
    <div id="auth-modal" class="modal-overlay" style="display: none;">
        <div class="modal-box" style="text-align: center;">
            <h1 style="font-size:35px; color:var(--primary); margin-bottom:10px">Blogane</h1>
            <div id="reg-fields" style="display:none"><input id="reg-name" class="input-box" placeholder="ÿßŸÑÿßÿ≥ŸÖ" style="margin-bottom:10px"></div>
            <input id="email" class="input-box" placeholder="ÿßŸÑÿ®ÿ±ŸäÿØ" style="margin-bottom:10px">
            <input id="pass" type="password" class="input-box" placeholder="ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±" style="margin-bottom:15px">
            <button class="btn" style="width:100%" onclick="auth()">ÿØÿÆŸàŸÑ</button>
            <p style="margin-top:20px; cursor:pointer; color:var(--gray)" onclick="toggleAuth()">ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØÿü</p>
        </div>
    </div>

    <!-- 40 Gifts Modal -->
    <div id="gift-modal" class="modal-overlay" style="display: none;">
        <div class="modal-box">
            <h3 style="text-align:center; color:var(--gold)">ŸÖÿ™ÿ¨ÿ± ÿßŸÑŸáÿØÿßŸäÿß</h3>
            <p style="text-align:center; font-size:12px">ÿ±ÿµŸäÿØŸÉ: <span id="gift-balance">0</span></p>
            <div class="gift-grid" id="gift-grid-content"></div>
            <button class="btn" style="width:100%; background:#333; margin-top:10px" onclick="document.getElementById('gift-modal').style.display='none'">ÿ•ŸÑÿ∫ÿßÿ°</button>
        </div>
    </div>

    <!-- Generic Modal -->
    <div class="modal-overlay" id="generic-modal"><div class="modal-box" id="modal-content"></div></div>

    <!-- VIEW 1: HOME -->
    <div id="view-home" class="view active">
        <div class="header"><div style="color:var(--gold)"><i class="fas fa-coins"></i> <span id="user-coins">0</span></div><img src="" id="header-avatar" class="avatar" onclick="openProfile(currentUser.email)"></div>
        <div style="padding: 15px;">
            <div class="card">
                <div style="display:flex; gap:10px"><img src="" id="my-avatar" class="avatar"><input id="post-txt" class="input-box" style="border-radius:25px; border:none" placeholder="ÿ®ŸÖÿßÿ∞ÿß ÿ™ŸÅŸÉÿ±ÿü"></div>
                <div style="display:flex; justify-content:space-between; margin-top:15px"><label style="color:#10b981; cursor:pointer"><i class="fas fa-image"></i> ÿµŸàÿ±ÿ©<input type="file" id="post-img" hidden></label><button class="btn" onclick="publishPost()">ŸÜÿ¥ÿ±</button></div>
            </div>
            <div id="feed"></div>
        </div>
    </div>

    <!-- VIEW 2: REELS -->
    <div id="view-reels" class="view" style="background: black;">
        <div style="position:absolute; top:20px; left:20px; z-index:100"><button class="btn" style="background:rgba(255,255,255,0.2); backdrop-filter:blur(5px)" onclick="showReelModal()">+</button></div>
        <div id="reels-container" style="height:100%; overflow-y:scroll; scroll-snap-type:y mandatory"></div>
    </div>

    <!-- VIEW 3: CHAT -->
    <div id="view-chat" class="view">
        <div class="header"><h2>ÿßŸÑÿØÿ±ÿØÿ¥ÿ©</h2></div>
        <div style="display:flex; padding:10px; gap:10px">
            <button class="btn" style="flex:1;background:#333" onclick="switchChat('global')">ÿπÿßŸÖÿ©</button>
            <button class="btn" style="flex:1;background:#333" onclick="switchChat('private')">ÿÆÿßÿµ</button>
            <button class="btn" style="flex:1;background:#333" onclick="switchChat('ai')">AI</button>
        </div>
        <div id="chat-global" style="height:calc(100% - 120px); display:flex; flex-direction:column"><div id="g-msgs" style="flex:1; overflow-y:auto; padding:10px"></div><div style="padding:10px; display:flex; gap:10px"><input id="g-input" class="input-box" placeholder="ÿßŸÉÿ™ÿ®..."><button class="btn" onclick="sendGlobal()">‚û§</button></div></div>
        <div id="chat-private" style="height:calc(100% - 120px); display:none; flex-direction:column">
            <div id="friends-list" style="flex:1; overflow-y:auto; padding:10px"></div>
            <div id="priv-conv" style="display:none; height:100%; flex-direction:column">
                <div style="padding:10px; display:flex; justify-content:space-between"><button class="btn" onclick="closePriv()">ÿπŸàÿØÿ©</button> <button class="btn" style="background:var(--gold);color:black" onclick="showGifts()">üéÅ</button></div>
                <div id="p-msgs" style="flex:1; overflow-y:auto; padding:10px"></div>
                <div style="padding:10px; display:flex; gap:10px"><input id="p-input" class="input-box" placeholder="ÿÆÿßÿµ..."><button class="btn" onclick="sendPriv()">‚û§</button></div>
            </div>
        </div>
        <div id="chat-ai" style="height:calc(100% - 120px); display:none; flex-direction:column"><div id="ai-msgs" style="flex:1; overflow-y:auto; padding:10px"></div><div style="padding:10px; display:flex; gap:10px"><input id="ai-input" class="input-box" placeholder="ÿßÿ≥ÿ£ŸÑ AI..."><button class="btn" onclick="sendAi()">‚û§</button></div></div>
    </div>

    <!-- VIEW 4: PROFILE (ME) -->
    <div id="view-profile" class="view"><div id="profile-content"></div></div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="navTo('home', this)"><i class="fas fa-home"></i></div>
        <div class="nav-item" onclick="navTo('reels', this)"><i class="fas fa-play-circle"></i></div>
        <div class="nav-item" onclick="navTo('chat', this)"><i class="fas fa-comments"></i></div>
        <div class="nav-item" onclick="openProfile(currentUser.email, this)"><i class="fas fa-user"></i></div>
    </nav>

    <script>
        const socket = io();
        let currentUser = null, currentPriv = null, isReg = false;

        // --- Init ---
        window.onload = () => { const s=localStorage.getItem('u'); if(s) socket.emit('login', JSON.parse(s)); else { hideLoader(); document.getElementById('auth-modal').style.display='flex'; } }
        function navTo(v, el) { 
            document.querySelectorAll('.view').forEach(x=>x.classList.remove('active')); 
            document.getElementById('view-'+v).classList.add('active'); 
            document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active')); 
            if(el) el.classList.add('active');
            if(v==='profile') socket.emit('get_profile_info', currentUser.email); // Refresh Me
        }
        function showLoader(t){ document.getElementById('loader').style.display='flex'; }
        function hideLoader(){ document.getElementById('loader').style.display='none'; }
        function showModal(h){ document.getElementById('modal-content').innerHTML=h; document.getElementById('generic-modal').style.display='flex'; }
        function closeModal(){ document.getElementById('generic-modal').style.display='none'; }

        // --- 40 Gifts List ---
        const gifts = [
            {n:"Ÿàÿ±ÿØÿ©",i:"üåπ",p:10}, {n:"ŸÇŸÑÿ®",i:"‚ù§Ô∏è",p:15}, {n:"ŸÇŸáŸàÿ©",i:"‚òï",p:20}, {n:"ŸÜÿßÿ±",i:"üî•",p:25},
            {n:"ÿ™ÿßÿ¨",i:"üëë",p:100}, {n:"ÿ£ŸÑŸÖÿßÿ≥",i:"üíé",p:150}, {n:"ÿ≥Ÿäÿßÿ±ÿ©",i:"üèéÔ∏è",p:500}, {n:"ÿ∑ÿßÿ¶ÿ±ÿ©",i:"‚úàÔ∏è",p:1000},
            {n:"ŸÇÿµÿ±",i:"üè∞",p:5000}, {n:"ÿ£ÿ≥ÿØ",i:"ü¶Å",p:300}, {n:"ŸÉÿπŸÉÿ©",i:"üéÇ",p:50}, {n:"ÿÆÿßÿ™ŸÖ",i:"üíç",p:200},
            {n:"ŸÜÿ¨ŸÖÿ©",i:"‚≠ê",p:10}, {n:"ŸÇŸÖÿ±",i:"üåô",p:20}, {n:"ÿ¥ŸÖÿ≥",i:"‚òÄÔ∏è",p:20}, {n:"ŸÉÿ±ÿ©",i:"‚öΩ",p:15},
            {n:"ŸäÿØ",i:"üëç",p:5}, {n:"ŸÇÿ®ŸÑÿ©",i:"üíã",p:30}, {n:"ÿ¥ŸàŸÉŸàŸÑÿß",i:"üç´",p:40}, {n:"ÿ®Ÿäÿ™ÿ≤ÿß",i:"üçï",p:30},
            {n:"ÿ®ÿ±ÿ∫ÿ±",i:"üçî",p:30}, {n:"ÿ®ÿ∑ÿßÿ∑ÿ≥",i:"üçü",p:15}, {n:"ÿ≥Ÿàÿ¥Ÿä",i:"üç£",p:60}, {n:"ÿπÿµŸäÿ±",i:"üçπ",p:25},
            {n:"ŸÖŸäŸÉÿ±ŸàŸÅŸàŸÜ",i:"üé§",p:80}, {n:"ÿ∫Ÿäÿ™ÿßÿ±",i:"üé∏",p:90}, {n:"ÿ≥ŸÖÿßÿπÿ©",i:"üéß",p:70}, {n:"ŸÉŸÖÿ®ŸäŸàÿ™ÿ±",i:"üíª",p:400},
            {n:"Ÿáÿßÿ™ŸÅ",i:"üì±",p:300}, {n:"ÿ≥ÿßÿπÿ©",i:"‚åö",p:150}, {n:"ŸÜÿ∏ÿßÿ±ÿ©",i:"üëì",p:50}, {n:"ŸÇÿ®ÿπÿ©",i:"üß¢",p:40},
            {n:"ÿ≠ÿ∞ÿßÿ°",i:"üëü",p:100}, {n:"ÿ≠ŸÇŸäÿ®ÿ©",i:"üëú",p:200}, {n:"ÿπÿ∑ÿ±",i:"üß¥",p:120}, {n:"ÿ±Ÿàÿ¨ÿßÿ™",i:"üíÑ",p:80},
            {n:"ŸÇÿ∑ÿ©",i:"üê±",p:60}, {n:"ŸÉŸÑÿ®",i:"üê∂",p:60}, {n:"ÿ®ÿßŸÜÿØÿß",i:"üêº",p:100}, {n:"ÿ™ŸÜŸäŸÜ",i:"üêâ",p:1000}
        ];
        const gGrid = document.getElementById('gift-grid-content');
        gGrid.innerHTML = gifts.map(g => `<div class="gift-item" onclick="sendGift('${g.n}',${g.p},'${g.i}')"><span class="gift-emoji">${g.i}</span><br>${g.p}</div>`).join('');

        // --- Auth ---
        function toggleAuth(){ isReg=!isReg; document.getElementById('reg-fields').style.display=isReg?'block':'none'; }
        function auth(){ const e=document.getElementById('email').value, p=document.getElementById('pass').value; if(isReg) socket.emit('register', {name:document.getElementById('reg-name').value, email:e, password:p}); else socket.emit('login', {email:e, password:p}); }
        socket.on('auth_success', (u)=>{ 
            currentUser=u; localStorage.setItem('u', JSON.stringify({email:u.email, password:u.password})); 
            document.getElementById('auth-modal').style.display='none'; hideLoader(); 
            document.getElementById('snd-start').play().catch(()=>{});
            updateMyUI(); 
        });
        function updateMyUI(){ document.getElementById('my-avatar').src=currentUser.avatar; document.getElementById('header-avatar').src=currentUser.avatar; document.getElementById('user-coins').innerText=currentUser.coins; }

        // --- Gift Ticker ---
        socket.on('gift_broadcast', (d) => {
            const tick = document.getElementById('gift-ticker');
            document.getElementById('ticker-text').innerHTML = `<img src="${d.avatar}" style="width:20px;border-radius:50%"> ${d.from} ÿ£ÿ±ÿ≥ŸÑ ${d.gift} ÿ•ŸÑŸâ ${d.to}`;
            tick.classList.add('show'); document.getElementById('snd-ticker').play().catch(()=>{});
            setTimeout(()=>tick.classList.remove('show'), 5000);
        });

        // --- Reels (Saved Likes/Comments) ---
        socket.on('init_data', (d) => {
            // Load Reels
            const rc = document.getElementById('reels-container'); rc.innerHTML = '';
            d.reels.forEach(r => renderReel(r));
            d.globalMessages.forEach(m => renderGlobalMsg(m));
        });
        function renderReel(r) {
            const l = r.likes && r.likes.includes(currentUser.email);
            const h = `
            <div class="reel-item">
                <video src="${r.url}" class="reel-video" loop onclick="this.paused?this.play():this.pause()"></video>
                <div class="reel-actions">
                    <div class="r-btn" onclick="socket.emit('toggle_like_reel',{id:${r.id},userEmail:currentUser.email})">
                        <i class="${l?'fas':'far'} fa-heart" style="color:${l?'red':'white'}" id="rl-icon-${r.id}"></i> <span id="rl-count-${r.id}">${r.likes?r.likes.length:0}</span>
                    </div>
                    <div class="r-btn" onclick="openReelComments(${r.id})">
                        <i class="fas fa-comment-dots"></i> <span id="rc-count-${r.id}">${r.comments?r.comments.length:0}</span>
                    </div>
                </div>
                <div class="reel-overlay"><b>${r.author}</b><br>${r.desc}</div>
                <div id="rc-sheet-${r.id}" class="reel-comments-sheet">
                    <div style="padding:10px;text-align:center;border-bottom:1px solid #333">ÿßŸÑÿ™ÿπŸÑŸäŸÇÿßÿ™ <span onclick="this.parentElement.parentElement.style.display='none'" style="float:left;cursor:pointer">‚úï</span></div>
                    <div id="rc-list-${r.id}" style="flex:1;overflow-y:auto;padding:10px"></div>
                    <div style="padding:10px;display:flex;gap:5px"><input id="rc-in-${r.id}" class="input-box" style="margin:0"><button class="btn" onclick="sendRC(${r.id})">‚û§</button></div>
                </div>
            </div>`;
            document.getElementById('reels-container').insertAdjacentHTML('beforeend', h);
            // Preload comments
            if(r.comments) document.getElementById(`rc-list-${r.id}`).innerHTML = r.comments.map(c=>`<div class="comment-item"><img src="${c.userAvatar}" class="avatar" style="width:25px;height:25px"><div><b>${c.userName}</b><br>${c.text}</div></div>`).join('');
        }
        window.openReelComments = (id) => document.getElementById(`rc-sheet-${id}`).style.display = 'flex';
        window.sendRC = (id) => { const t=document.getElementById(`rc-in-${id}`).value; if(t){socket.emit('comment_reel',{id, text:t, userEmail:currentUser.email, userName:currentUser.name, userAvatar:currentUser.avatar}); document.getElementById(`rc-in-${id}`).value='';} }
        socket.on('update_reel_stats', (d)=>{
            document.getElementById(`rl-count-${d.id}`).innerText = d.likes;
            document.getElementById(`rc-count-${d.id}`).innerText = d.comments;
        });
        socket.on('new_reel_comment', (d) => {
            const l = document.getElementById(`rc-list-${d.reelId}`);
            if(l) l.innerHTML += `<div class="comment-item"><img src="${d.comment.userAvatar}" class="avatar" style="width:25px;height:25px"><div><b>${d.comment.userName}</b><br>${d.comment.text}</div></div>`;
        });

        // --- Chat, Profile, Posts (Standard) ---
        function switchChat(t){ ['global','private','ai'].forEach(x=>document.getElementById(`chat-${x}`).style.display=x===t?'flex':'none'); }
        function sendGlobal(){ const t=document.getElementById('g-input').value; if(t){socket.emit('send_global_msg',{text:t,author:currentUser.name,email:currentUser.email,avatar:currentUser.avatar});document.getElementById('g-input').value='';} }
        socket.on('receive_global_msg', renderGlobalMsg);
        function renderGlobalMsg(m) { const me=m.email===currentUser.email; document.getElementById('g-msgs').innerHTML+=`<div style="display:flex;flex-direction:column;align-items:${me?'flex-start':'flex-end'}"><div class="msg-bubble ${me?'msg-me':'msg-other'}"><b>${me?'':m.author+':'}</b> ${m.text}</div></div>`; }
        function sendAi(){ const t=document.getElementById('ai-input').value; if(t){ document.getElementById('ai-msgs').innerHTML+=`<div class="msg-bubble msg-me">${t}</div>`; socket.emit('send_ai_msg',t); document.getElementById('ai-input').value=''; } }
        socket.on('receive_ai_msg', (m)=>{ document.getElementById('ai-msgs').innerHTML+=`<div class="msg-bubble msg-other">${m.text}</div>`; });
        
        window.openProfile = (e) => { navTo('profile'); showLoader('ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...'); socket.emit('get_profile_info', e); }
        socket.on('open_profile_view', ({user, posts}) => {
            hideLoader();
            document.getElementById('profile-content').innerHTML = `
                <div class="profile-cover"><img src="${user.avatar}" class="profile-pic-lg"></div>
                <div style="text-align:center;padding-top:60px"><h2>${user.name}</h2><p style="color:var(--gray)">${user.bio||''}</p>
                <div style="margin-top:15px">${user.email===currentUser.email ? `<button class="btn" onclick="showEditProfile()">ÿ™ÿπÿØŸäŸÑ</button>` : `<button class="btn" onclick="startChat('${user.email}','${user.name}')">ŸÖÿ±ÿßÿ≥ŸÑÿ©</button>`}</div></div>
                <div style="padding:15px;margin-top:20px">${posts.map(p=>`<div class="card"><p>${p.content||'ÿµŸàÿ±ÿ©'}</p></div>`).join('')}</div>`;
        });
        
        // Gifts & Private
        function showGifts(){ document.getElementById('gift-balance').innerText=currentUser.coins; document.getElementById('gift-modal').style.display='flex'; }
        function sendGift(n, c, i){ if(currentUser.coins<c){alert('ÿ±ÿµŸäÿØŸÉ ŸÑÿß ŸäŸÉŸÅŸä');return;} socket.emit('send_gift',{from:currentUser.email, to:currentPriv, giftName:n, cost:c, icon:i}); document.getElementById('gift-modal').style.display='none'; }
        socket.on('update_coins', (c)=>{ currentUser.coins=c; document.getElementById('user-coins').innerText=c; document.getElementById('snd-coin').play().catch(()=>{}); });
        
        window.startChat = (e, n) => { currentPriv=e; navTo('chat'); switchChat('private'); document.getElementById('friends-list').style.display='none'; document.getElementById('priv-conv').style.display='flex'; document.getElementById('p-name-header').innerText=n; document.getElementById('p-msgs').innerHTML=''; socket.emit('get_private_msgs',{u1:currentUser.email, u2:e}); }
        function closePriv(){ document.getElementById('priv-conv').style.display='none'; document.getElementById('friends-list').style.display='block'; }
        function sendPriv(){ const t=document.getElementById('p-input').value; if(t){ socket.emit('send_private_msg',{from:currentUser.email, to:currentPriv, text:t}); document.getElementById('p-input').value=''; } }
        socket.on('load_private_msgs', (ms)=>{ document.getElementById('p-msgs').innerHTML = ms.map(m=>`<div class="msg-bubble ${m.from===currentUser.email?'msg-me':'msg-other'}">${m.isGift?m.icon+' '+m.text:m.text}</div>`).join(''); });
        socket.on('receive_private_msg', (m)=>{ if(m.from===currentPriv || m.from===currentUser.email) { document.getElementById('p-msgs').innerHTML+=`<div class="msg-bubble ${m.from===currentUser.email?'msg-me':'msg-other'}">${m.isGift?m.icon+' '+m.text:m.text}</div>`; document.getElementById('snd-msg').play().catch(()=>{}); } });

        // Posts
        let postImg=null; document.getElementById('post-img').addEventListener('change', function(){ const f=this.files[0]; if(f){const r=new FileReader(); r.onload=(e)=>{postImg=e.target.result;}; r.readAsDataURL(f);} });
        function publishPost(){ const t=document.getElementById('post-txt').value; if(t||postImg){ showLoader('ŸÜÿ¥ÿ±...'); socket.emit('new_post', {content:t, media:postImg, author:currentUser.name, email:currentUser.email, avatar:currentUser.avatar, context:'general', contextId:null}); document.getElementById('post-txt').value=''; postImg=null; } }
        socket.on('upload_complete', hideLoader);
        socket.on('receive_post', (p)=> { document.getElementById('feed').insertAdjacentHTML('afterbegin', `<div class="card"><div style="display:flex;gap:10px"><img src="${p.avatar}" class="avatar"><b>${p.author}</b></div><p>${p.content||''}</p>${p.media?`<img src="${p.media}" style="width:100%;border-radius:10px">`:''}</div>`); });
        socket.on('load_posts', (ps)=> { document.getElementById('feed').innerHTML=''; ps.reverse().forEach(p=>document.getElementById('feed').insertAdjacentHTML('afterbegin', `<div class="card"><div style="display:flex;gap:10px"><img src="${p.avatar}" class="avatar"><b>${p.author}</b></div><p>${p.content||''}</p>${p.media?`<img src="${p.media}" style="width:100%;border-radius:10px">`:''}</div>`)); });
    </script>
</body>
    </html>
